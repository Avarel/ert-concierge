!function(e){function t(t){for(var n,i,o=t[0],l=t[1],c=t[2],d=0,u=[];d<o.length;d++)i=o[d],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&u.push(a[i][0]),a[i]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);for(h&&h(t);u.length;)u.shift()();return r.push.apply(r,c||[]),s()}function s(){for(var e,t=0;t<r.length;t++){for(var s=r[t],n=!0,o=1;o<s.length;o++){var l=s[o];0!==a[l]&&(n=!1)}n&&(r.splice(t--,1),e=i(i.s=s[0]))}return e}var n={},a={2:0},r=[];function i(t){if(n[t])return n[t].exports;var s=n[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=n,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(s,n,function(t){return e[t]}.bind(null,n));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var o=window.webpackJsonp=window.webpackJsonp||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var h=l;r.push([25,1]),s()}([function(e,t){e.exports=React},function(e,t){e.exports=BABYLON},,,function(e,t){e.exports=ReactDOM},,,,,function(e,t,s){var n=s(2),a=s(10);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var r={insert:"head",singleton:!1};n(a,r);e.exports=a.locals||{}},function(e,t,s){(t=s(3)(!1)).push([e.i,'body{height:100vh;width:100vw}.app{height:100%;width:100%;overflow:hidden}.app canvas{width:100%;height:100%;touch-action:none}.app #views{width:100%;height:100%}.float-window{z-index:100;position:fixed;display:flex;bottom:0;width:400px;max-height:100%;box-sizing:border-box;transition:margin-left .5s,margin-bottom .5s;flex-direction:column;font-family:"Titillium Web","Roboto",sans-serif}.float-window.left{left:50px}.float-window.right{right:50px}@media screen and (max-width: 500px){.float-window{left:0 !important;right:0;bottom:0;max-height:50vh;width:100vw}}.float-window>.tabbed>.tabbed-content{border-radius:5px 5px 0 0}',""]),e.exports=t},function(e,t,s){var n=s(2),a=s(12);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var r={insert:"head",singleton:!1};n(a,r);e.exports=a.locals||{}},function(e,t,s){(t=s(3)(!1)).push([e.i,'.rstyled{background-color:#b4b4b4;position:relative;font-family:"Titillium Web","Roboto",sans-serif;box-sizing:border-box;overflow:auto;display:flex;flex-direction:column}.rstyled.full{width:100%;height:100%}.rstyled h1{font-size:30px;margin:5px 0;font-weight:bold}.rstyled h2{font-size:20px;margin-bottom:5px;font-weight:bold}.rstyled p{margin-bottom:5px}.rstyled p:last-child{margin-bottom:0}.rstyled button{flex:1 0 0;display:flex;justify-content:center;font-family:inherit;font-size:15px;margin:5px;padding:10px;border:none;border-radius:5px;transition:box-shadow .2s,transform .2s,background-color .2s;background:#fffd;color:#000;box-shadow:0px 5px 5px rgba(0,0,0,.067)}.rstyled button .white-text,.rstyled button button.purple,.rstyled button button.blue,.rstyled button button.green,.rstyled button button.yellow,.rstyled button button.orange,.rstyled button button.red{color:#fff}.rstyled button.red{background:#df0000}.rstyled button.orange{background:#ff6c0c}.rstyled button.yellow{background:#cac700}.rstyled button.green{background:#00b199}.rstyled button.blue{background:#0c4dff}.rstyled button.purple{background:#9800df}.rstyled button:focus{outline:none}.rstyled button:hover{background:#fff}.rstyled button:active{background:#fff5;box-shadow:none}.rstyled .input-value{margin-bottom:5px;display:flex}.rstyled .input-value>.label{flex:0 0 35%;text-align:end;padding-right:10px;box-sizing:border-box;align-self:center}.rstyled .input-value>.field{flex:1 0 0;flex-direction:column}.rstyled .input-value>.field input{font-family:inherit;width:100%;padding:7px;box-sizing:border-box;border:none;background:rgba(255,255,255,.8);text-align:right;transition:background-color .2s}.rstyled .input-value>.field input:read-only{background:rgba(255,255,255,.4);outline:none}.rstyled .input-value>.field input:first-child{border-radius:5px 5px 0 0}.rstyled .input-value>.field input:not(:first-child):not(:last-child){border-radius:0}.rstyled .input-value>.field input:not(:last-child){margin-bottom:1px}.rstyled .input-value>.field input:last-child{border-radius:0 0 5px 5px}.rstyled .input-value>.field input:first-child:last-child{border-radius:5px}.rstyled .rs-pad{display:flex;padding:10px;flex-direction:column}.rstyled .rs-pad.light{background:rgba(255,255,255,.4)}.rstyled .rs-box,.rstyled .rs-card{display:flex;flex-direction:column;width:100%;padding:10px;box-sizing:border-box;word-break:break-word;background:rgba(255,255,255,.25);box-shadow:0px 5px 5px rgba(0,0,0,.067);margin-bottom:10px}.rstyled .rs-box.light,.rstyled .light.rs-card{background:rgba(255,255,255,.4)}.rstyled .rs-box:last-child,.rstyled .rs-card:last-child{margin-bottom:0}.rstyled .rs-card{border-radius:5px}.rstyled .rs-flex-row{display:flex;flex-direction:row;margin-bottom:10px}.rstyled .rs-flex-row .rs-card{margin-bottom:0;margin-right:10px}.rstyled .rs-flex-row .rs-card:last-child{margin-right:0}.rstyled .rs-flex-row:last-child{margin-bottom:0}',""]),e.exports=t},function(e,t,s){var n=s(2),a=s(14);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var r={insert:"head",singleton:!1};n(a,r);e.exports=a.locals||{}},function(e,t,s){(t=s(3)(!1)).push([e.i,'.sidebar{position:fixed;z-index:100;top:0;left:0;flex-direction:column;display:flex;overflow:auto;width:70px;height:100%;padding:15px;pointer-events:none}.sidebar.horizontal{height:70px;width:100%;flex-direction:row}.sidebar::-webkit-scrollbar{width:5px}.sidebar::-webkit-scrollbar-track{background:transparent}.sidebar::-webkit-scrollbar-thumb{background:#444;border-radius:5px}.sidebar::-webkit-scrollbar-thumb:hover{background:#555}.sidebar .icon{pointer-events:all;flex:0 0 auto;width:70px;height:70px;margin:0px 10px 10px 0;box-sizing:border-box;position:relative}.sidebar .icon img,.sidebar .icon p{height:100%;width:100%;background:#000;border-radius:50%;cursor:pointer;transition:border-radius .2s}.sidebar .icon img:hover,.sidebar .icon p:hover{border-radius:10px}.sidebar .icon p{color:#fff;line-height:70px;text-align:center;font-size:40px;font-family:"Titillium Web","Roboto",sans-serif;user-select:none}.tippy-box{font-family:"Titillium Web","Roboto",sans-serif !important}',""]),e.exports=t},,,function(e,t,s){var n=s(2),a=s(18);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var r={insert:"head",singleton:!1};n(a,r);e.exports=a.locals||{}},function(e,t,s){(t=s(3)(!1)).push([e.i,".views{width:100%;height:100%;display:flex}.views .view{flex:1 0 0;height:100%}.gutter.gutter-horizontal{cursor:ew-resize;background-color:#000;height:100vh}",""]),e.exports=t},function(e,t,s){var n=s(2),a=s(20);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var r={insert:"head",singleton:!1};n(a,r);e.exports=a.locals||{}},function(e,t,s){(t=s(3)(!1)).push([e.i,'.chat-container{background:rgba(204,204,204,.95);color:#000;height:100%;width:100%;display:flex;flex-direction:column;font-family:"Titillium Web","Roboto",sans-serif}.chat-container .chat-input{position:absolute;display:flex;width:100%;height:0px;bottom:50px;background:#aaa;padding-left:10px;padding-right:10px;box-sizing:border-box}.chat-container .chat-input input.chat-input-field{background:#aaa;border:0;padding:5px;box-sizing:border-box;height:40px;width:100%;border-radius:5px;margin-right:5px;outline:none;font-family:"Titillium Web","Roboto",sans-serif}.chat-container .chat-input button.chat-submit-btn{line-height:40px;text-align:center;height:40px;flex:0 0 40px;box-sizing:border-box;border-radius:5px;background:#fff;user-select:none;cursor:pointer;border:none}.chat-container .chat-input button.chat-submit-btn:hover{background:#eee}.chat-container .chat-messages{padding:15px;height:100%;width:100%;box-sizing:border-box;display:flex;flex-direction:column;position:relative;overflow:auto}.chat-container .chat-messages::-webkit-scrollbar{width:10px}.chat-container .chat-messages::-webkit-scrollbar-track{background:transparent}.chat-container .chat-messages::-webkit-scrollbar-thumb{background:#aaa;border-radius:5px}.chat-container .chat-messages::-webkit-scrollbar-thumb:hover{background:#bbb}.chat-container .chat-messages .chat-item{display:flex;max-width:90%;flex-direction:column;align-self:flex-start}.chat-container .chat-messages .chat-item:last-child{margin-bottom:40px}.chat-container .chat-messages .chat-item.you{align-self:flex-end}.chat-container .chat-messages .chat-item.you .name{text-align:right}.chat-container .chat-messages .chat-item.you .text{border-radius:5px 0px 5px 5px;align-self:flex-end}.chat-container .chat-messages .chat-item.status{width:100%;max-width:100%}.chat-container .chat-messages .chat-item.status .text{text-align:center;background:none;margin:0;padding:0;color:#888}.chat-container .chat-messages .chat-item .name{text-align:left;margin:10px 10px 0px}.chat-container .chat-messages .chat-item .text{border-radius:0 5px 5px;background:#fff;padding:10px;word-break:break-all;margin:5px;white-space:pre-wrap}',""]),e.exports=t},function(e,t,s){var n=s(2),a=s(22);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var r={insert:"head",singleton:!1};n(a,r);e.exports=a.locals||{}},function(e,t,s){(t=s(3)(!1)).push([e.i,".tabbed{height:auto;width:100%;display:flex;flex-direction:column}.tabbed.hidden>.tabbed-content{display:none}.tabbed.hidden>.tabbed-header>.tabbed-drawer{transform:rotate(180deg)}.tabbed>.tabbed-header{margin-left:5px;margin-right:5px;flex:0 0 40px;display:flex;flex-direction:row;overflow-x:auto;overflow-y:hidden;width:auto;text-shadow:0px 0px 10px rgba(0,0,0,.5)}.tabbed>.tabbed-header::-webkit-scrollbar{width:5px;height:5px}.tabbed>.tabbed-header::-webkit-scrollbar-track{background:transparent}.tabbed>.tabbed-header::-webkit-scrollbar-thumb{background:#666;border-radius:5px}.tabbed>.tabbed-header::-webkit-scrollbar-thumb:hover{background:#777}.tabbed>.tabbed-header::-webkit-scrollbar-thumb:active{background:#888}.tabbed>.tabbed-header>.tabbed-header-label,.tabbed>.tabbed-header>.tabbed-drawer{display:inline;line-height:40px;background:transparent;text-align:center;padding:0px 10px 0px;color:#ccc;cursor:pointer;transition:color .2s;white-space:nowrap}.tabbed>.tabbed-header>.tabbed-header-label:hover,.tabbed>.tabbed-header>.tabbed-header-label.active,.tabbed>.tabbed-header>.tabbed-drawer{color:#fff}.tabbed>.tabbed-header>.tabbed-drawer{min-width:40px;width:40px;padding:0;transition:transform .5s cubic-bezier(0.5, -0.5, 0.5, 1.5)}.tabbed>.tabbed-content{background:#bbb;width:100%;border-radius:5px;overflow:hidden;color:#000;display:flex;position:relative;box-shadow:0px 0px 10px rgba(0,0,0,.25)}.tabbed>.tabbed-content>.tabbed-body{height:100%;width:100%;display:none}.tabbed>.tabbed-content>.tabbed-body.active,.tabbed>.tabbed-header.tabbed-content>.tabbed-body.tabbed-drawer{display:inherit}",""]),e.exports=t},function(e,t,s){var n=s(2),a=s(24);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var r={insert:"head",singleton:!1};n(a,r);e.exports=a.locals||{}},function(e,t,s){(t=s(3)(!1)).push([e.i,".planetary-controls{overflow:auto}.planetary-controls .planetary-upload{display:flex}.planetary-controls .planetary-upload input[type=file]{flex:1 0 0;align-self:center}.planetary-controls #icons{justify-content:space-evenly}.planetary-controls #icons i{font-size:30px;opacity:.5;transition:transform .2s;cursor:pointer}.planetary-controls #icons i:hover{transform:scale(1.2)}",""]),e.exports=t},function(e,t,s){"use strict";s.r(t),s.d(t,"Viewer",(function(){return G}));s(9);class n{constructor(e,t,s=!0){this.client=e,this.serviceName=t,this.autoSubscribe=s,this.__subscribed=!1}get subscribed(){return this.__subscribed}onClose(e){this.__subscribed&&this.onUnsubscribe()}sendToService(e){this.client.sendPayload({type:"MESSAGE",target:{type:"SERVICE",service:this.serviceName},data:e})}onReceive(e){var t;switch(e.type){case"MESSAGE":"MESSAGE"==e.type&&(null===(t=e.origin.service)||void 0===t?void 0:t.name)==this.serviceName&&this.onServiceMessage(e.data);break;case"HELLO":this.autoSubscribe&&this.client.sendPayload({type:"SERVICE_FETCH",service:this.serviceName},e=>{"SERVICE_FETCH_RESULT"==e.type&&this.subscribe()});break;case"SERVICE_DELETE_RESULT":e.service.name==this.serviceName&&(console.info(`Service: "${this.serviceName}" deleted on the server.`),this.__subscribed&&(this.__subscribed=!1,this.onUnsubscribe()));break;case"SERVICE_CREATE_RESULT":e.service.name==this.serviceName&&this.autoSubscribe&&this.subscribe();break;case"SELF_UNSUBSCRIBE_RESULT":e.service.name==this.serviceName&&this.__subscribed&&e.successful&&(console.info(`Service: Unsubscribed to "${this.serviceName}".`),this.__subscribed=!1,this.onUnsubscribe())}}subscribe(){this.client.sendPayload({type:"SELF_SUBSCRIBE",service:this.serviceName},e=>{"SELF_SUBSCRIBE_RESULT"==e.type&&e.successful&&(console.info(`Service: Subscribed to "${this.serviceName}".`),this.__subscribed=!0,this.onSubscribe())})}unsubscribe(){this.client.sendPayload({type:"SELF_UNSUBSCRIBE",service:this.serviceName})}}class a{constructor(e,t,s,n=!1,a=!1){this.name=e,this.baseUrl=t,this.nickname=s,this.secure=n,this.reconnect=a,this.seq=-1,this.handlers=[],this.waiters=new Map,this.reconnectInterval=1e4}get uuid(){return this._uuid}get wsUrl(){const e=new URL("ws",this.wsUrlOverride?this.wsUrlOverride:this.baseUrl);return e.protocol=this.secure?"wss":"ws",this.portOverride&&(e.port=this.portOverride),e.toString()}fileUrl(e,t){const s=new URL(`fs/${e}/${t}`,this.fsUrlOverride?this.fsUrlOverride:this.baseUrl);return s.protocol=this.secure?"https":"http",this.portOverride&&(s.port=this.portOverride),s.toString()}connect(e,t){console.info("Client: Trying to connect to ",this.wsUrl),this.version=e,this.secret=t,this.socket=new WebSocket(this.wsUrl,"ert-concierge"),this.socket.onopen=e=>this.onOpen(e),this.socket.onmessage=e=>this.onReceive(e),this.socket.onerror=e=>this.onError(e),this.socket.onclose=e=>this.onClose(e)}sendPayload(e,t){if(null==this.socket)throw new Error("Socket is not connected");this.socket.send(JSON.stringify(e));const s=this.seq;if(this.seq+=1,t){const e=window.setTimeout(()=>{this.waiters.delete(s)},5e3);this.waiters.set(s,{seq:s,timeoutHandle:e,callback:t})}return s}close(e,t,s=!0){if(null==this.socket)throw new Error("Socket is not connected");this.socket.close(e,t),s?this.tryReconnect():(this.socket=void 0,this.version=void 0,this.secret=void 0)}addHandler(e){this.handlers.push(e)}removeHandler(e){for(let t=0;t<this.handlers.length;t++)this.handlers[t]===e&&(this.handlers.splice(t,1),t-=1)}clearHandlers(){this.handlers.length=0}tryReconnect(){this.reconnect&&(console.warn("Client: Connection closed, reconnecting in",this.reconnectInterval,"ms"),setTimeout(()=>{this.connect(this.version,this.secret)},this.reconnectInterval))}onOpen(e){var t;for(const s of this.handlers)null===(t=s.onOpen)||void 0===t||t.call(s,e);if(null==this.version)throw new Error("Version is undefined");console.log("Client: Identifying with version",this.version),this.sendPayload({type:"IDENTIFY",name:this.name,version:this.version,secret:this.secret,tags:["babylon"]})}onClose(e){var t;for(const s of this.handlers)null===(t=s.onClose)||void 0===t||t.call(s,e);console.warn(e.code,e.reason),this.tryReconnect()}onReceive(e){var t;const s=JSON.parse(e.data);if("object"==typeof s&&s.hasOwnProperty("type")){const e=s;"HELLO"==e.type&&(console.log("Assigned uuid",e.uuid),this._uuid=e.uuid,this.seq=0);const n=e.seq;if(null!=n){const t=this.waiters.get(n);t&&(this.waiters.delete(n),window.clearTimeout(t.timeoutHandle),t.callback(e))}for(const s of this.handlers)null===(t=s.onReceive)||void 0===t||t.call(s,e)}}onError(e){var t;for(const s of this.handlers)null===(t=s.onError)||void 0===t||t.call(s,e);console.log(e)}}var r,i=s(1),o=s(0),l=s.n(o);s(11);!function(e){class t extends l.a.PureComponent{render(){return l.a.createElement("div",Object.assign({className:"rs-flex-row"},this.props),this.props.children)}}e.Row=t;class s extends l.a.PureComponent{render(){return l.a.createElement("div",Object.assign({className:"rs-pad"+(this.props.light?" light":"")},this.props),this.props.children)}}e.Pad=s;class n extends l.a.PureComponent{render(){return l.a.createElement("div",Object.assign({className:"rs-box"},this.props),this.props.children)}}e.Box=n;class a extends l.a.PureComponent{render(){return l.a.createElement("div",Object.assign({className:"rs-card"},this.props),this.props.children)}}e.Card=a;class r extends l.a.Component{constructor(e){super(e),this.state={values:e.inputs.map(e=>{})}}handleKeyDown(e,t){13===e.keyCode&&(e.preventDefault(),this.setState((e,s)=>{var n;const a=s.inputs[t].tag;if(a){const r=s.inputs[t].value,i=e.values[t];if(i&&i!=r){null===(n=s.onSubmit)||void 0===n||n.call(s,a,i);const r=e.values.slice();return r[t]=void 0,{values:r}}}return e}))}handleChange(e,t){let s=e.currentTarget.value;this.setState((e,n)=>{const a=n.inputs[t].value;s==a&&(s=void 0);const r=e.values.slice();return r[t]=s,{values:r}})}render(){return l.a.createElement("div",{className:"input-value"},l.a.createElement("div",{className:"label"},this.props.label),l.a.createElement("div",{className:"field"},this.props.inputs.map(({tag:e,value:t},s)=>{const n=this.state.values[s];return l.a.createElement("input",{readOnly:null==e,value:n||t,onChange:e?e=>this.handleChange(e,s):void 0,onKeyDown:e?e=>this.handleKeyDown(e,s):void 0})})))}}e.InputValue=r}(r||(r={}));var c=r;class h extends l.a.Component{handleRespawn(){this.props.handler.sendToService({type:"SPAWN_ENTITY"})}render(){return l.a.createElement("div",{className:"rstyled full"},l.a.createElement(c.Pad,{light:!0},l.a.createElement("h1",null,"Rust Physics"),l.a.createElement("p",null,"Hypercasual Game"),l.a.createElement("button",{onClick:()=>this.handleRespawn()},"Respawn")),l.a.createElement(c.Pad,{style:{flexGrow:1}},l.a.createElement(c.Card,null,l.a.createElement("h2",null,"Instructions"),l.a.createElement("p",null,"Click on your own box colors to duplicate it."),l.a.createElement("p",null,"Click on boxes with another color to destroy them.")),l.a.createElement(c.Card,null,l.a.createElement("p",null,"Simulation written in Rust with Specs + Serde."))),l.a.createElement(c.Pad,{light:!0},l.a.createElement("p",null,"SURF 2020 / OVRAS")))}}class d{constructor(e,t){this.centroid=e,this.mesh=t}static create(e,t,s,n,a=1){const r=t.map(e=>e.scaleInPlace(a)),o=new i.PolygonMeshBuilder("polytri",r,s).build(void 0,50*a);o.position.y+=50*a;var l=new i.StandardMaterial("myMaterial",s);return l.diffuseColor=n,o.material=l,o.actionManager=new i.ActionManager(s),o.actionManager.registerAction(new i.SetValueAction(i.ActionManager.OnPointerOutTrigger,o.material,"emissiveColor",l.emissiveColor)),o.actionManager.registerAction(new i.SetValueAction(i.ActionManager.OnPointerOverTrigger,o.material,"emissiveColor",i.Color3.White())),o.actionManager.registerAction(new i.InterpolateValueAction(i.ActionManager.OnPointerOutTrigger,o,"position.y",o.position.y,150)),o.actionManager.registerAction(new i.InterpolateValueAction(i.ActionManager.OnPointerOverTrigger,o,"position.y",60*a,150)),new d(e.scaleInPlace(a),o)}setColor(e){this.mesh.material.diffuseColor=e}moveTo(e){const t=e.subtract(this.centroid);this.mesh.position.addInPlace(t),this.centroid.set(e.x,e.y,e.z)}dispose(){this.mesh.dispose()}}function u(e){return new i.Vector2(e.x-500,e.y-500)}function p(e){function t(e){return Math.max(0,Math.min(e,255))/255}return new i.Color3(t(e[0]),t(e[1]),t(e[2]))}class m extends n{constructor(e,t,s){super(e,"physics_engine"),this.renderer=t,this.tabbedComponent=s,this.shapes=new Map,this.visualScale=.02}onSubscribe(){var e;console.log("Fetching..."),this.sendToService({type:"FETCH_ENTITIES"}),this.sendToService({type:"SPAWN_ENTITY"}),this.tab=null===(e=this.tabbedComponent)||void 0===e?void 0:e.addTab(this.serviceName,"Rust Physics"),this.renderTab()}onUnsubscribe(){var e;this.clearShapes(),null===(e=this.tabbedComponent)||void 0===e||e.removeTab(this.serviceName),this.tab=void 0}onServiceMessage(e){switch(e.type){case"ENTITY_NEW":const t=e.entity;this.createShape(t.id,t.centroid,t.points,t.color);break;case"ENTITY_DELETE":for(const t of e.ids)this.removeShape(t);break;case"ENTITY_DUMP":console.log("Dumping entities!"),this.clearShapes();for(const t of e.entities)this.createShape(t.id,t.centroid,t.points,t.color);break;case"POSITION_DUMP":for(const t of e.updates)this.updateShape(t.id,t.position);break;case"COLOR_UPDATE":this.updateColor(e.id,e.color)}}renderTab(){this.tab&&(this.tab.reactContent=l.a.createElement(h,{handler:this}))}clearShapes(){for(const e of this.shapes.values())e.dispose();this.shapes.clear()}createShape(e,t,s,n){const a=u(t),r=s.map(u),o=p(n),l=d.create(new i.Vector3(a.x,0,a.y),r,this.renderer.scene,o,this.visualScale);this.shapes.set(e,l),l.mesh.actionManager.registerAction(new i.ExecuteCodeAction(BABYLON.ActionManager.OnPickTrigger,()=>{console.log("Clicking on object ",e,"."),this.sendToService({type:"TOUCH_ENTITY",id:e})}))}removeShape(e){const t=this.shapes.get(e);t&&(t.dispose(),this.shapes.delete(e))}updateShape(e,t){const s=this.shapes.get(e);if(s){const e=u(t);s.moveTo(new i.Vector3(e.x,0,e.y).scaleInPlace(this.visualScale))}}updateColor(e,t){const s=this.shapes.get(e);s&&s.setColor(p(t))}}s(13);var b=s(5);s(15);class v extends l.a.PureComponent{innerRender(){return this.props.imgSrc?l.a.createElement("div",{className:"icon"},l.a.createElement("img",{src:this.props.imgSrc})):l.a.createElement("div",{className:"icon"},l.a.createElement("p",{style:{backgroundColor:this.props.colorCss}},this.props.label.charAt(0)))}render(){return l.a.createElement(b.a,{content:this.props.label,placement:"right"},this.innerRender())}}class g extends l.a.PureComponent{constructor(e){super(e),this.state={items:e.icons||new Map}}render(){return l.a.createElement("div",{className:"sidebar"},Array.from(this.props.icons.values(),e=>l.a.createElement(v,Object.assign({},e))))}}var f,y=s(4),E=s.n(y);!function(e){class t{constructor(e,s,n){this.id=e,this.label=s,this.imgSrc=n,this.colorCss=t.makeHSLColor(this.id)}static hashString(e){let t,s,n=0;for(t=0;t<e.length;t++)s=e.charCodeAt(t),n=(n<<5)-n+s,n|=0;return n}static makeHSLColor(e){return`hsl(${t.hashString(e)%360}, 100%, 25%)`}toProps(){return{id:this.id,label:this.label,colorCss:this.colorCss,imgSrc:this.imgSrc}}}e.Icon=t;e.Instance=class{constructor(e){if(this.iconsMap=new Map,"string"==typeof e){const t=document.querySelector(e);if(!t)throw new Error("Can not insantiate Tabbed on an undefined element.");this.element=t}else this.element=e}addIcon(e,s,n){const a=new t(e,s,n);return this.iconsMap.set(e,a),this.renderToDOM(),a}clear(){this.iconsMap.clear(),this.renderToDOM()}getIcon(e){return this.iconsMap.get(e)}removeIcon(e){const t=this.iconsMap.delete(e);return this.renderToDOM(),t}render(){return l.a.createElement(g,{icons:Array.from(this.iconsMap.values(),e=>e.toProps())})}renderToDOM(){this.element&&(this.component=E.a.render(this.render(),this.element))}}}(f||(f={}));var w,x=f;s(17);class S extends l.a.Component{render(){return l.a.createElement("div",{className:"view",ref:this.props.refobj},this.props.jsxContent)}}class C extends l.a.Component{render(){return l.a.createElement("div",{className:"views"},Array.from(this.props.views,e=>l.a.createElement(S,Object.assign({},e))))}}!function(e){class t{constructor(e,t){this.instance=e,this.id=t,this.jsxContent=null,this.ref=l.a.createRef()}get htmlElement(){return this.jsxContent=void 0,this.ref.current}set reactContent(e){this.jsxContent=e,this.instance.renderToDOM()}toProps(){return{id:this.id,jsxContent:this.jsxContent,refobj:this.ref}}}e.View=t;e.Instance=class{constructor(e){if(this.viewsMap=new Map,null==e)throw new Error("Root element must not be null!");if("string"==typeof e){const t=document.querySelector(e);if(!t)throw new Error("Query selector "+e+" return null!");this.element=t}else this.element=e}addView(e){const s=new t(this,e);return this.viewsMap.set(e,s),this.renderToDOM(),s}getView(e){return this.viewsMap.get(e)}removeView(e){this.viewsMap.delete(e),this.renderToDOM()}render(){return l.a.createElement(C,{views:Array.from(this.viewsMap.values(),e=>e.toProps())})}renderToDOM(){this.element&&(this.component=E.a.render(this.render(),this.element))}}}(w||(w={}));var T,k=w;s(19);class I extends l.a.Component{constructor(e){super(e),this.messagesEndRef=l.a.createRef()}componentDidUpdate(){const e=this.messagesEndRef.current;e&&(e.scrollTop=e.scrollHeight)}set onSubmit(e){this.setState({onSubmit:e})}render(){return l.a.createElement("div",{className:"chat-container"},l.a.createElement("div",{className:"chat-messages",ref:this.messagesEndRef},this.props.items.map(e=>l.a.createElement(M,Object.assign({},e)))),l.a.createElement(_,{onSubmit:this.props.onSubmit}))}}class M extends l.a.PureComponent{render(){return"MESSAGE"==this.props.type?l.a.createElement("div",{className:"chat-item"+(this.props.you?" you":"")},l.a.createElement("div",{className:"name"},this.props.name),l.a.createElement("div",{className:"text"},this.props.text)):l.a.createElement("div",{className:"chat-item status"},l.a.createElement("div",{className:"text"},this.props.text))}}class _ extends l.a.PureComponent{constructor(e){super(e),this.state={text:""},this.handleSubmit=this.handleSubmit.bind(this),this.handleChange=this.handleChange.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this)}handleChange(e){this.setState({text:e.target.value})}handleKeyDown(e){13===e.keyCode&&(e.preventDefault(),this.handleSubmit())}handleSubmit(){this.setState((e,t)=>{var s;return e.text&&(null===(s=t.onSubmit)||void 0===s||s.call(t,e.text)),{text:""}})}render(){return l.a.createElement("div",{className:"chat-input"},l.a.createElement("input",{className:"chat-input-field",type:"text",placeholder:"Text message...",value:this.state.text,onChange:this.handleChange,onKeyDown:this.handleKeyDown}),l.a.createElement("button",{className:"chat-submit-btn",onClick:this.handleSubmit},l.a.createElement("i",{className:"fa fa-paper-plane"})))}}!function(e){class t{constructor(e){this.text=e}toObject(){return{type:"STATUS",text:this.text}}}e.Status=t;class s{constructor(e,t,s){this.name=e,this.text=t,this.you=s}toObject(){return{type:"MESSAGE",name:this.name,text:this.text,you:this.you}}}e.Message=s;e.Instance=class{constructor(e,t){if(this.onSubmit=t,this.entries=[],"string"==typeof e){const t=document.querySelector(e);if(!t)throw new Error("Can not insantiate Tabbed on an undefined element.");this.element=t}else this.element=e}addEntry(e){this.entries.push(e),this.renderToDOM()}addStatus(e){this.addEntry(new t(e))}addMessage(e,t,n=!1){this.addEntry(new s(e,t,n))}render(){return l.a.createElement(I,{items:Array.from(this.entries,e=>e.toObject()),onSubmit:this.onSubmit})}renderToDOM(){this.element&&(this.component=E.a.render(this.render(),this.element))}}}(T||(T={}));var R,A=T;s(21);class O extends l.a.Component{render(){return l.a.createElement("div",{className:"tabbed-header-label"+(this.props.component.isActive(this.props.id)?" active":""),onClick:()=>this.props.component.makeActive(this.props.id)},this.props.label)}}class P extends l.a.Component{render(){return this.props.jsxContent||null===this.props.jsxContent?this.props.component.isActive(this.props.id)?l.a.createElement("div",{className:"tabbed-body"+(this.props.component.isActive(this.props.id)?" active":""),ref:this.props.refobj},this.props.jsxContent):null:l.a.createElement("div",{className:"tabbed-body"+(this.props.component.isActive(this.props.id)?" active":""),ref:this.props.refobj})}}class N extends l.a.Component{constructor(e){var t;super(e),this.state={shown:e.initShow||!1,activeId:null===(t=e.tabs[0])||void 0===t?void 0:t.id}}get isShown(){return this.state.shown&&this.state.activeId}isActive(e){return this.state.shown&&this.state.activeId==e}toggleShown(e=!this.state.shown){this.setState({shown:e})}makeActive(e){this.toggleShown(!0),this.activeId=e}get activeId(){return this.state.activeId}set activeId(e){this.setState({activeId:e})}render(){return l.a.createElement("div",{className:"tabbed"+(this.isShown?"":" hidden")},l.a.createElement("div",{className:"tabbed-header",style:this.props.reverseHeader?{flexDirection:"row-reverse"}:{}},l.a.createElement("div",{className:"tabbed-drawer",onClick:()=>this.toggleShown()},l.a.createElement("i",{className:"fa fa-angle-double-down"})),Array.from(this.props.tabs,e=>l.a.createElement(O,Object.assign({component:this},e)))),l.a.createElement("div",{className:"tabbed-content",style:{height:this.props.contentHeight}},Array.from(this.props.tabs,e=>l.a.createElement(P,Object.assign({component:this},e)))))}}!function(e){class t{constructor(e,t,s){this.instance=e,this.id=t,this.label=s,this.jsxContent=null,this.ref=l.a.createRef()}get isActive(){return this.instance.activeId==this.id}get htmlElement(){return this.jsxContent=void 0,this.instance.renderToDOM(),this.ref.current}set reactContent(e){this.jsxContent=e,this.instance.renderToDOM()}toProps(){return{jsxContent:this.jsxContent,id:this.id,label:this.label,refobj:this.ref}}}e.Tab=t;e.Instance=class{constructor(e,t,s=!1,n=!1){if(this.contentHeight=t,this.reverseHeader=s,this.initShow=n,this.tabsMap=new Map,"string"==typeof e){const t=document.querySelector(e);if(!t)throw new Error("Can not insantiate Tabbed on an undefined element.");this.element=t}else this.element=e}get tabs(){return this.tabsMap}get activeId(){var e;return null===(e=this.component)||void 0===e?void 0:e.activeId}addTab(e,s){const n=new t(this,e,s);return this.tabsMap.set(e,n),this.renderToDOM(),n}getTab(e){return this.tabsMap.get(e)}removeTab(e){var t;const s=this.tabsMap.delete(e);return(null===(t=this.component)||void 0===t?void 0:t.activeId)==e&&(this.component.activeId=void 0),this.renderToDOM(),s}render(){return l.a.createElement(N,{tabs:Array.from(this.tabsMap.values(),e=>e.toProps()),contentHeight:this.contentHeight,reverseHeader:this.reverseHeader,initShow:this.initShow})}renderToDOM(){this.element&&(this.component=E.a.render(this.render(),this.element))}}}(R||(R={}));var U=R;class D extends n{constructor(e,t){super(e,"chat_service"),this.tabComponent=t}chatInstanceUpdateReact(){this.tab&&this.chatInstance&&(this.tab.reactContent=this.chatInstance.render())}onEnter(e){this.sendToService({type:"INPUT",text:e})}onServiceMessage(e){var t,s;"STATUS"==e.type?null===(t=this.chatInstance)||void 0===t||t.addStatus(e.text):"TEXT"==e.type&&(null===(s=this.chatInstance)||void 0===s||s.addMessage(e.author,e.text,e.author_uuid==this.client.uuid)),this.chatInstanceUpdateReact()}onSubscribe(){this.tab=this.tabComponent.addTab(this.serviceName,"Chat"),this.chatInstance=new A.Instance(void 0,e=>this.onEnter(e)),this.chatInstanceUpdateReact()}onUnsubscribe(){this.tabComponent.removeTab(this.serviceName),this.tab=void 0,this.chatInstance=void 0}}s(23);class L extends l.a.Component{constructor(e){super(e),this.state={fps:0,fdelta:0,pmeshes:0}}componentDidMount(){this.loop=window.setInterval(()=>{this.setState(()=>({fps:this.props.handler.view.renderer.engine.getFps().toFixed(2),fdelta:this.props.handler.view.renderer.engine.getDeltaTime().toFixed(2),pmeshes:this.props.handler.planets.size}))},1e3)}componentWillUnmount(){window.clearInterval(this.loop)}render(){this.props.handler;return l.a.createElement(c.Card,null,l.a.createElement("h2",null,"Rendering Statistics"),l.a.createElement(c.InputValue,{label:"FPS",inputs:[{value:this.state.fps}]}),l.a.createElement(c.InputValue,{label:"Frame Delta",inputs:[{value:this.state.fdelta+"ms"}]}),l.a.createElement(c.InputValue,{label:"Planet Meshes",inputs:[{value:this.state.pmeshes}]}))}}class V extends l.a.Component{render(){return l.a.createElement("div",{className:"planetary-controls rstyled full"},l.a.createElement(c.Pad,{light:!0},l.a.createElement(H,{handler:this.props.handler}),l.a.createElement(F,{handler:this.props.handler})),l.a.createElement(c.Pad,null,l.a.createElement(j,{handler:this.props.handler}),l.a.createElement(L,{handler:this.props.handler}),l.a.createElement(c.Card,null,l.a.createElement("h2",null,"Planetary Simulation"),l.a.createElement("p",null,"Python Simulation by Alison Noyes"),l.a.createElement("p",null,"BabylonJS Front-end by An Tran"))))}}class F extends l.a.Component{handleFieldUpdate(e,t,s){this.props.handler.sendToService({type:"UPDATE_DATA",target:e,field:t,value:s})}conditional(){let e=this.props.handler;if(null!=e.planetLock||null!=e.planetHover){let t=e.planets.get(e.planetLock||e.planetHover);return t?l.a.createElement(z,{data:t.data,onSubmit:(e,s)=>this.handleFieldUpdate(t.id,e,s)}):null}return e.sysData?l.a.createElement(B,{data:e.sysData,onSubmit:(e,t)=>this.handleFieldUpdate("system",e,t)}):null}render(){return l.a.createElement(c.Pad,null,this.conditional())}}class j extends l.a.Component{submitHandler(e){e.preventDefault();let t=new FormData(e.currentTarget);this.props.handler.upload(t)}render(){return l.a.createElement(c.Card,null,l.a.createElement("h2",null,"Upload JSON System"),l.a.createElement("p",null,"Try out your own planetary systems!"),l.a.createElement("form",{className:"planetary-upload",onSubmit:e=>this.submitHandler(e)},l.a.createElement("input",{type:"file",name:"file"}),l.a.createElement("button",{type:"submit"},"Submit")))}}class H extends l.a.Component{constructor(e){super(e),this.fb=()=>this.sendState("FAST_BACKWARD"),this.pause=()=>this.sendState("PAUSE"),this.play=()=>this.sendState("PLAY"),this.sf=()=>this.sendState("STEP_FORWARD"),this.ff=()=>this.sendState("FAST_FORWARD")}sendState(e){this.props.handler.sendToService({type:e})}render(){return l.a.createElement(c.Card,null,l.a.createElement(c.Row,{id:"icons"},l.a.createElement("i",{className:"fa fa-fast-backward",onClick:this.fb}),l.a.createElement("i",{className:"fa fa-pause",onClick:this.pause}),l.a.createElement("i",{className:"fa fa-play",onClick:this.play}),l.a.createElement("i",{className:"fa fa-step-forward",onClick:this.sf}),l.a.createElement("i",{className:"fa fa-fast-forward",onClick:this.ff})))}}class B extends l.a.Component{render(){return l.a.createElement(l.a.Fragment,null,l.a.createElement("h1",null,"SYSTEM"),l.a.createElement(c.InputValue,{label:"Gravity Constant",onSubmit:this.props.onSubmit,inputs:[{tag:"gravityConstant",value:this.props.data.gravityConstant}]}),l.a.createElement(c.InputValue,{label:"Scale",onSubmit:this.props.onSubmit,inputs:[{tag:"scale",value:this.props.data.scale}]}),l.a.createElement(c.InputValue,{label:"Time Scale",onSubmit:this.props.onSubmit,inputs:[{value:this.props.data.timeScale}]}),l.a.createElement(c.InputValue,{label:"Body Scale",onSubmit:this.props.onSubmit,inputs:[{tag:"bodyScale",value:this.props.data.bodyScale}]}),l.a.createElement(c.InputValue,{label:"Central Body Scale",onSubmit:this.props.onSubmit,inputs:[{tag:"centralBodyScale",value:this.props.data.centralBodyScale}]}),l.a.createElement(c.InputValue,{label:"Elasticity",onSubmit:this.props.onSubmit,inputs:[{tag:"elasticity",value:this.props.data.elasticity}]}),l.a.createElement(c.InputValue,{label:"Central Body Name",onSubmit:this.props.onSubmit,inputs:[{value:this.props.data.centralBodyName}]}),l.a.createElement(c.InputValue,{label:"Hand Mass",onSubmit:this.props.onSubmit,inputs:[{value:this.props.data.handMass}]}),l.a.createElement(c.InputValue,{label:"Boundary",onSubmit:this.props.onSubmit,inputs:[{tag:"boundary",value:this.props.data.boundary}]}))}}class z extends l.a.Component{render(){return l.a.createElement(l.a.Fragment,null,l.a.createElement("h1",null,this.props.data.name.toUpperCase()),l.a.createElement(c.InputValue,{label:"Mass",onSubmit:this.props.onSubmit,inputs:[{tag:"mass",value:this.props.data.mass}]}),l.a.createElement(c.InputValue,{label:"Radius",onSubmit:this.props.onSubmit,inputs:[{tag:"radius",value:this.props.data.radius}]}),l.a.createElement(c.InputValue,{label:"Location",onSubmit:this.props.onSubmit,inputs:[{tag:"location[0]",value:this.props.data.location[0]},{tag:"location[1]",value:this.props.data.location[1]},{tag:"location[2]",value:this.props.data.location[2]}]}),l.a.createElement(c.InputValue,{label:"Orbit Radius",onSubmit:this.props.onSubmit,inputs:[{tag:"orbitRadius",value:this.props.data.orbitRadius}]}),l.a.createElement(c.InputValue,{label:"Orbit Speed",onSubmit:this.props.onSubmit,inputs:[{tag:"orbitSpeed",value:this.props.data.orbitSpeed}]}),l.a.createElement(c.InputValue,{label:"Location",onSubmit:this.props.onSubmit,inputs:[{tag:"direction[0]",value:this.props.data.direction[0]},{tag:"direction[1]",value:this.props.data.direction[1]},{tag:"direction[2]",value:this.props.data.direction[2]}]}))}}class Y{constructor(e,t,s,n,a,r){this.id=t,this.centroid=s,this.mesh=i.MeshBuilder.CreateSphere("sphere "+this.id,{diameter:2*n},a),this.mesh.position=s;const o=new i.StandardMaterial("myMaterial",a);o.diffuseColor=r,this.mesh.material=o;const l=o.emissiveColor;this.mesh.actionManager=new i.ActionManager(a),this.trailMesh=new i.TrailMesh("planet trail "+this.id,this.mesh,a,Math.min(.02,n),1e3,!0),this.mesh.actionManager.registerAction(new i.ExecuteCodeAction(i.ActionManager.OnPointerOverTrigger,()=>{o.emissiveColor=i.Color3.Red(),e.planetHover=this.id,e.renderInformation()})),this.mesh.actionManager.registerAction(new i.ExecuteCodeAction(i.ActionManager.OnPointerOutTrigger,()=>{o.emissiveColor=l,e.planetHover==this.id&&(e.planetHover=void 0,e.renderInformation())})),this.mesh.actionManager.registerAction(new i.ExecuteCodeAction(i.ActionManager.OnPickTrigger,()=>{e.planetLock==this.id?e.planetLock=void 0:e.planetLock=this.id,e.renderInformation()}))}dispose(){var e,t;null===(e=this.mesh.actionManager)||void 0===e||e.dispose(),null===(t=this.trailMesh)||void 0===t||t.dispose(),this.mesh.dispose()}setColor(e){this.mesh.material.diffuseColor=e}moveTo(e){let t=e.subtract(this.centroid);this.mesh.position.addInPlace(t),this.centroid.set(e.x,e.y,e.z)}}var G,W=function(e,t,s,n){return new(s||(s=Promise))((function(a,r){function i(e){try{l(n.next(e))}catch(e){r(e)}}function o(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,o)}l((n=n.apply(e,t||[])).next())}))};class J extends n{constructor(e,t,s){super(e,"planetary_simulation"),this.view=t,this.tabbedComponent=s,this.visualScale=5,this.planets=new Map}onSubscribe(){var e;this.tab=null===(e=this.tabbedComponent)||void 0===e?void 0:e.addTab(this.serviceName,"Planetary Controls"),console.log("Planet simulator client is ready to go!"),this.sendToService({type:"FETCH_SYSTEM_DATA"})}onUnsubscribe(){var e;null===(e=this.tabbedComponent)||void 0===e||e.removeTab(this.serviceName),this.clearShapes(),console.log("Planet simulator client has disconnected!")}onServiceMessage(e){switch(e.type){case"SYSTEM_REMOVE_PLANETS":for(const t of e.ids){let e=this.planets.get(t);e&&(e.dispose(),this.planets.delete(t))}this.renderInformation();break;case"SYSTEM_DATA_DUMP":this.sysData=e.data,this.clearShapes(),this.sendToService({type:"FETCH_SYSTEM_OBJS"}),this.renderInformation(!0);break;case"SYSTEM_OBJS_DUMP":if(null==this.sysData)return;for(let t of e.objects){let e=new i.Vector3(t.location[0],t.location[1],t.location[2]).scaleInPlace(this.visualScale/this.sysData.scale);if(this.planets.has(t.name)){let s=this.planets.get(t.name);s.moveTo(e),s.data=t}else{if(!this.view.scene)throw new Error("Scene not initialized!");{let s=t.radius*this.sysData.bodyScale*this.visualScale/this.sysData.scale,n=i.Color3.FromArray(t.color);t.name==this.sysData.centralBodyName&&(console.log("Found central body!"),s*=this.sysData.centralBodyScale);let a=new Y(this,t.name,e,s,this.view.scene,n);a.data=t,this.planets.set(t.name,a)}}}this.renderInformation();break;case"SYSTEM_CLEAR":console.log("Clearing shapes"),this.renderInformation(),this.clearShapes()}}clearShapes(){for(let e of this.planets.keys()){const t=this.planets.get(e);t&&(t.dispose(),this.planets.delete(e))}}renderInformation(e=!1){this.tab&&(this.tab.isActive||e)&&(this.tab.reactContent=l.a.createElement(V,{handler:this}))}upload(e){return W(this,void 0,void 0,(function*(){const t=this.client.fileUrl(this.client.name,"system.json"),s=new Headers;s.append("x-fs-key",this.client.uuid);const n=yield fetch(t,{method:"POST",headers:s,body:e});switch(n.status){case 200:case 201:this.sendToService({type:"LOAD_SYSTEM",url:t.toString()});break;default:alert("Unexpected response:"+n.status+" "+n.statusText)}}))}}class q extends l.a.PureComponent{innerRender(){return this.props.nickname?l.a.createElement(l.a.Fragment,null,l.a.createElement("h2",null,this.props.nickname),l.a.createElement(c.InputValue,{label:"Name",inputs:[{value:this.props.name}]})):l.a.createElement("h2",null,this.props.name)}render(){return l.a.createElement(c.Card,null,this.innerRender(),l.a.createElement(c.InputValue,{label:"UUID",inputs:[{value:this.props.uuid}]}),l.a.createElement(c.InputValue,{label:"Tags",inputs:[{value:this.props.tags}]}))}}class K extends l.a.Component{render(){return l.a.createElement("div",{className:"rstyled full"},l.a.createElement(c.Pad,{light:!0},l.a.createElement("h1",null,"Clients"),l.a.createElement("p",null,"Clients connected to the server.")),l.a.createElement(c.Pad,{style:{flexGrow:1}},this.props.users.map(e=>l.a.createElement(q,Object.assign({},e)))))}}class ${constructor(e,t,s){this.client=e,this.ui=t,this.tabComponent=s,this.users=[],this.tab=this.tabComponent.addTab($.TAB_ID,"Clients"),this.render()}onClose(e){this.ui.clear(),this.tabComponent.removeTab($.TAB_ID),this.tab=void 0,this.clear()}onReceive(e){switch(e.type){case"HELLO":this.client.sendPayload({type:"CLIENT_FETCH_ALL"},e=>{if("CLIENT_FETCH_ALL_RESULT"==e.type){this.clear();for(const t of e.clients)this.addClient(t)}}),this.render();break;case"CLIENT_JOINED":this.addClient(e.client);break;case"CLIENT_LEFT":this.removeUser(e.client.uuid)}}clear(){this.users.length=0}addClient(e){this.ui.addIcon(e.uuid,e.nickname||e.name),this.users.push(e),this.render()}removeUser(e){this.ui.removeIcon(e);for(let t=0;t<this.users.length;t++)this.users[t].uuid==e&&(this.users.splice(t,1),t--);this.render()}render(){this.tab&&(this.tab.reactContent=l.a.createElement(K,{name:this.client.name,uuid:this.client.uuid,users:this.users}))}}$.TAB_ID="clients";class Q{constructor(e,t,s){this.renderer=e,this.canvas=t,this.scene=s,this.isFocused=!1,t.addEventListener("click",()=>{this.isFocused||(this.attachControl(),this.isFocused=!0)}),t.addEventListener("blur",()=>{this.detachControl(),this.isFocused=!1})}universalCamera(){console.log("View: Using universal camera.");let e=new i.UniversalCamera("UniversalCamera",new i.Vector3(0,15,-15),this.scene);e.setTarget(new i.Vector3(0,0,0)),e.speed=.5,e.keysDownward.push(17,16),e.keysUpward.push(32),e.keysUp.push(87,38),e.keysDown.push(83,40),e.keysLeft.push(65,37),e.keysRight.push(68,39),this.setCamera(e)}arcRotateCamera(){console.log("View: Using arc roatate camera.");let e=new i.ArcRotateCamera("ArcCamera",Math.PI,Math.PI,15,i.Vector3.Zero(),this.scene);e.setPosition(new i.Vector3(0,5,15)),e.speed=.25,e.keysUp.push(87,38),e.keysDown.push(83,40),e.keysLeft.push(65,37),e.keysRight.push(68,39),this.setCamera(e)}setCamera(e){this.camera&&(this.scene.removeCamera(this.camera),this.camera.dispose()),this.detachControl(),this.camera=e,this.scene.addCamera(e),this.scene.activeCamera=e,this.renderer.engine.registerView(this.canvas,e),this.attachControl()}attachControl(){console.log("View: Attaching controls."),this.renderer.engine.inputElement=this.canvas,this.scene.attachControl(!0,!0,!0),this.camera&&this.camera.attachControl(this.canvas,!1)}detachControl(){console.log("View: Detaching controls."),this.scene.detachControl(),this.camera&&this.camera.detachControl(this.canvas)}}class X{constructor(){this.views=[];let e=document.createElement("canvas");this.engine=new i.Engine(e,!0)}createView(e){let t=new i.Scene(this.engine);new i.PointLight("light1",new i.Vector3(0,500,0),t).intensity=1;let s=t.createDefaultEnvironment({skyboxSize:500,groundSize:500,groundShadowLevel:.5,enableGroundShadow:!0});s.skybox.isPickable=!1,s.setMainColor(i.Color3.FromHexString("#909090"));let n=new Q(this,e,t);return this.views.push(n),n}start(){this.engine.runRenderLoop(()=>{var e;for(const t of this.views)(null===(e=this.engine.activeView)||void 0===e?void 0:e.target)===t.canvas&&t.scene.render()}),window.addEventListener("resize",()=>{this.engine.resize()})}stop(){this.engine.stopRenderLoop()}}function Z(){return l.a.createElement("div",{className:"rstyled full"},l.a.createElement(c.Pad,{light:!0},l.a.createElement("h1",null,"ERT Concierge"),l.a.createElement("h2",null,"BabylonJS Client")),l.a.createElement(c.Pad,{style:{flexGrow:1}},l.a.createElement(c.Row,null,l.a.createElement(c.Card,null,l.a.createElement("h2",null,"Intern"),l.a.createElement("p",null,"An Tran")),l.a.createElement(c.Card,null,l.a.createElement("h2",null,"Mentor"),l.a.createElement("p",null,"Santiago Lombeyda"))),l.a.createElement(c.Card,null,l.a.createElement("h2",null,"Front-End"),l.a.createElement("p",null,"Pug/SCSS/TypeScript"),l.a.createElement("p",null,"Webpack + ReactJS")),l.a.createElement(c.Card,null,l.a.createElement("h2",null,"Back-End"),l.a.createElement("p",null,"Rust"))),l.a.createElement(c.Pad,{light:!0},l.a.createElement("p",null,"SURF 2020 / OVRAS")))}class ee extends l.a.PureComponent{innerRender(){return this.props.nickname?l.a.createElement(l.a.Fragment,null,l.a.createElement("h2",null,this.props.nickname),l.a.createElement(c.InputValue,{label:"Name",inputs:[{value:this.props.name}]}),l.a.createElement(c.InputValue,{label:"Owner UUID",inputs:[{value:this.props.owner_uuid}]})):l.a.createElement(l.a.Fragment,null,l.a.createElement("h2",null,this.props.name),l.a.createElement(c.InputValue,{label:"Owner UUID",inputs:[{value:this.props.owner_uuid}]}))}render(){return l.a.createElement(c.Card,null,this.innerRender(),l.a.createElement(c.Row,null,this.props.isService?l.a.createElement(l.a.Fragment,null,l.a.createElement("button",{onClick:()=>this.props.handler.subscribe(this.props.name)},"Subscribe"),l.a.createElement("button",{onClick:()=>this.props.handler.unsubscribe(this.props.name)},"Unsubscribe")):null))}}class te extends l.a.Component{render(){return l.a.createElement("div",{className:"rstyled full"},l.a.createElement(c.Pad,{light:!0},l.a.createElement("h1",null,"Services"),l.a.createElement("p",null,"List of services currently available on the server.")),l.a.createElement(c.Pad,{style:{flexGrow:1}},this.props.groups.map(e=>l.a.createElement(ee,Object.assign({handler:this.props.handler,isService:this.props.services.has(e.name)},e)))))}}class se{constructor(e,t){this.client=e,this.tabComponent=t,this.groups=[],this.services=new Map,this.render()}onClose(e){this.tabComponent.removeTab(se.TAB_ID),this.tab=void 0,this.groups.length=0}onReceive(e){switch(e.type){case"HELLO":this.tab=this.tabComponent.addTab(se.TAB_ID,"Services"),this.client.sendPayload({type:"SERVICE_FETCH_ALL"},e=>{if("SERVICE_FETCH_ALL_RESULT"==e.type){this.clear();for(const t of e.services)this.addGroup(t)}}),this.render();break;case"SERVICE_CREATE_RESULT":this.client.sendPayload({type:"SERVICE_FETCH",service:e.service.name},e=>{"SERVICE_FETCH_RESULT"==e.type&&this.addGroup(e.service)});break;case"SERVICE_DELETE_RESULT":this.removeGroup(e.service.name)}}clear(){this.groups.length=0}addGroup(e){this.groups.push(e),this.render()}removeGroup(e){for(let t=0;t<this.groups.length;t++)this.groups[t].name==e&&(this.groups.splice(t,1),t--);this.render()}addService(e){this.services.set(e.serviceName,e),this.client.addHandler(e)}removeService(e){let t=this.services.get(e);t&&(this.services.delete(e),this.client.removeHandler(t))}subscribe(e){let t=this.services.get(e);t&&t.subscribe(),this.client.sendPayload({type:"SELF_SUBSCRIBE",service:e})}unsubscribe(e){let t=this.services.get(e);t&&t.unsubscribe(),this.client.sendPayload({type:"SELF_UNSUBSCRIBE",service:e})}render(){this.tab&&(this.tab.reactContent=l.a.createElement(te,{handler:this,services:new Set(this.services.keys()),groups:this.groups}))}}se.TAB_ID="services",(G||(G={})).start=function(){const e=new URLSearchParams(window.location.search);let t=e.get("server");if(!t||0==t.length)return;let s=e.get("name");s&&0!=s.length&&function(e,t){const s=new U.Instance("#left-controls",500),n=new U.Instance("#right-controls",800,!0);n.addTab("about","About").reactContent=l.a.createElement(Z);const r=new x.Instance("#sidebar-app"),i=new k.Instance("#views");let o=i.addView("main");i.renderToDOM();let c=document.createElement("canvas");o.htmlElement.appendChild(c);let h=new X,d=new a(t,e,void 0,!1,!0),u=h.createView(c);u.universalCamera();let p=new $(d,r,s);d.addHandler(p);let b=new se(d,s);d.addHandler(b),b.addService(new D(d,s)),b.addService(new J(d,u,n)),b.addService(new m(d,u,n)),h.start(),d.connect("0.2.0")}(t,s)},G.start()}]);